<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JSON | Nova Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="我那摊大饼一样的零散学习笔记">
    
    <link rel="preload" href="/NovaBlog/assets/css/0.styles.26d8bde2.css" as="style"><link rel="preload" href="/NovaBlog/assets/js/app.7283b6f5.js" as="script"><link rel="preload" href="/NovaBlog/assets/js/2.6539ea43.js" as="script"><link rel="preload" href="/NovaBlog/assets/js/36.44753080.js" as="script"><link rel="prefetch" href="/NovaBlog/assets/js/10.681f19e7.js"><link rel="prefetch" href="/NovaBlog/assets/js/11.adb3fca2.js"><link rel="prefetch" href="/NovaBlog/assets/js/12.e509a0f8.js"><link rel="prefetch" href="/NovaBlog/assets/js/13.0ace9699.js"><link rel="prefetch" href="/NovaBlog/assets/js/14.f11331b6.js"><link rel="prefetch" href="/NovaBlog/assets/js/15.c3fe2b37.js"><link rel="prefetch" href="/NovaBlog/assets/js/16.76473f3a.js"><link rel="prefetch" href="/NovaBlog/assets/js/17.1e6e96a7.js"><link rel="prefetch" href="/NovaBlog/assets/js/18.de0f476b.js"><link rel="prefetch" href="/NovaBlog/assets/js/19.464c0b71.js"><link rel="prefetch" href="/NovaBlog/assets/js/20.adc0ad6e.js"><link rel="prefetch" href="/NovaBlog/assets/js/21.a75102d0.js"><link rel="prefetch" href="/NovaBlog/assets/js/22.409ca266.js"><link rel="prefetch" href="/NovaBlog/assets/js/23.4b83f159.js"><link rel="prefetch" href="/NovaBlog/assets/js/24.b80958e2.js"><link rel="prefetch" href="/NovaBlog/assets/js/25.bbdd2bef.js"><link rel="prefetch" href="/NovaBlog/assets/js/26.0ed31014.js"><link rel="prefetch" href="/NovaBlog/assets/js/27.80bd39a6.js"><link rel="prefetch" href="/NovaBlog/assets/js/28.2772d3d5.js"><link rel="prefetch" href="/NovaBlog/assets/js/29.d14c59ce.js"><link rel="prefetch" href="/NovaBlog/assets/js/3.672c28f4.js"><link rel="prefetch" href="/NovaBlog/assets/js/30.3edde461.js"><link rel="prefetch" href="/NovaBlog/assets/js/31.da8777c1.js"><link rel="prefetch" href="/NovaBlog/assets/js/32.fa19d459.js"><link rel="prefetch" href="/NovaBlog/assets/js/33.2d3adc2b.js"><link rel="prefetch" href="/NovaBlog/assets/js/34.35850d01.js"><link rel="prefetch" href="/NovaBlog/assets/js/35.b14e62bb.js"><link rel="prefetch" href="/NovaBlog/assets/js/37.8d2088d4.js"><link rel="prefetch" href="/NovaBlog/assets/js/38.4366f780.js"><link rel="prefetch" href="/NovaBlog/assets/js/39.c9f5137d.js"><link rel="prefetch" href="/NovaBlog/assets/js/4.854c56f8.js"><link rel="prefetch" href="/NovaBlog/assets/js/40.68c696f4.js"><link rel="prefetch" href="/NovaBlog/assets/js/41.7190c7b3.js"><link rel="prefetch" href="/NovaBlog/assets/js/42.7710aff4.js"><link rel="prefetch" href="/NovaBlog/assets/js/43.9f513289.js"><link rel="prefetch" href="/NovaBlog/assets/js/44.493f11ea.js"><link rel="prefetch" href="/NovaBlog/assets/js/45.66cd96d8.js"><link rel="prefetch" href="/NovaBlog/assets/js/46.f5e4e401.js"><link rel="prefetch" href="/NovaBlog/assets/js/47.c2f3caf8.js"><link rel="prefetch" href="/NovaBlog/assets/js/48.74afa3cf.js"><link rel="prefetch" href="/NovaBlog/assets/js/49.ea737da6.js"><link rel="prefetch" href="/NovaBlog/assets/js/5.f7ccee55.js"><link rel="prefetch" href="/NovaBlog/assets/js/50.3eca0141.js"><link rel="prefetch" href="/NovaBlog/assets/js/51.949ffca7.js"><link rel="prefetch" href="/NovaBlog/assets/js/52.d007ce86.js"><link rel="prefetch" href="/NovaBlog/assets/js/53.252a0d24.js"><link rel="prefetch" href="/NovaBlog/assets/js/54.97c86c53.js"><link rel="prefetch" href="/NovaBlog/assets/js/55.4577ea3a.js"><link rel="prefetch" href="/NovaBlog/assets/js/56.085a6c0d.js"><link rel="prefetch" href="/NovaBlog/assets/js/57.6804712d.js"><link rel="prefetch" href="/NovaBlog/assets/js/58.559b3cac.js"><link rel="prefetch" href="/NovaBlog/assets/js/59.48650730.js"><link rel="prefetch" href="/NovaBlog/assets/js/6.14027d31.js"><link rel="prefetch" href="/NovaBlog/assets/js/60.e53abbd4.js"><link rel="prefetch" href="/NovaBlog/assets/js/61.53d32451.js"><link rel="prefetch" href="/NovaBlog/assets/js/62.f93973c5.js"><link rel="prefetch" href="/NovaBlog/assets/js/63.9dd5b9b3.js"><link rel="prefetch" href="/NovaBlog/assets/js/64.4a1ac6da.js"><link rel="prefetch" href="/NovaBlog/assets/js/65.84f958d2.js"><link rel="prefetch" href="/NovaBlog/assets/js/66.38972cd8.js"><link rel="prefetch" href="/NovaBlog/assets/js/67.97df1d7d.js"><link rel="prefetch" href="/NovaBlog/assets/js/68.f78ccdc1.js"><link rel="prefetch" href="/NovaBlog/assets/js/69.9d476a9c.js"><link rel="prefetch" href="/NovaBlog/assets/js/7.5c5bd089.js"><link rel="prefetch" href="/NovaBlog/assets/js/70.28382d01.js"><link rel="prefetch" href="/NovaBlog/assets/js/71.4a4fdf3a.js"><link rel="prefetch" href="/NovaBlog/assets/js/72.646ad1ce.js"><link rel="prefetch" href="/NovaBlog/assets/js/73.2f2ebeb1.js"><link rel="prefetch" href="/NovaBlog/assets/js/74.22b83718.js"><link rel="prefetch" href="/NovaBlog/assets/js/75.50e2585a.js"><link rel="prefetch" href="/NovaBlog/assets/js/76.998e5fbe.js"><link rel="prefetch" href="/NovaBlog/assets/js/77.e805e4a0.js"><link rel="prefetch" href="/NovaBlog/assets/js/8.f20fe421.js"><link rel="prefetch" href="/NovaBlog/assets/js/9.749c610b.js">
    <link rel="stylesheet" href="/NovaBlog/assets/css/0.styles.26d8bde2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/NovaBlog/" class="home-link router-link-active"><!----> <span class="site-name">Nova Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/NovaBlog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/Mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/Spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/SpringBoot/" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/SpringMVC/" class="nav-link">
  Spring MVC
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/基础/" class="nav-link">
  基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tools" class="mobile-dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/接口/" class="nav-link">
  接口
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/日志&amp;json/" class="nav-link">
  日志&amp;json
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/部署/" class="nav-link">
  部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/web/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/状态管理/" class="nav-link">
  状态管理
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/组件库/" class="nav-link">
  组件库
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/路由/" class="nav-link">
  路由
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/中间件/ELK/" class="nav-link">
  ELK
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/数据库/MySQL/" class="nav-link">
  My SQL
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/数据库/Redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/其他/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/动规/" class="nav-link">
  动规
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/贪心/" class="nav-link">
  贪心
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/链表二叉树/" class="nav-link">
  链表二叉树
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/NovaBlog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/Mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/Spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/SpringBoot/" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/SpringMVC/" class="nav-link">
  Spring MVC
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/基础/" class="nav-link">
  基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tools" class="mobile-dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/接口/" class="nav-link">
  接口
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/日志&amp;json/" class="nav-link">
  日志&amp;json
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/部署/" class="nav-link">
  部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/web/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/状态管理/" class="nav-link">
  状态管理
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/组件库/" class="nav-link">
  组件库
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/路由/" class="nav-link">
  路由
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/中间件/ELK/" class="nav-link">
  ELK
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/数据库/MySQL/" class="nav-link">
  My SQL
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/数据库/Redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/其他/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/动规/" class="nav-link">
  动规
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/贪心/" class="nav-link">
  贪心
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/链表二叉树/" class="nav-link">
  链表二叉树
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>日志&amp;json</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NovaBlog/Tools/%E6%97%A5%E5%BF%97&amp;json/" aria-current="page" class="sidebar-link">列表</a></li><li><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html" class="active sidebar-link">JSON</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#json" class="sidebar-link">JSON</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#fastjson" class="sidebar-link">FastJson</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#jackson" class="sidebar-link">JackSon</a></li></ul></li><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#logger" class="sidebar-link">Logger</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#jul" class="sidebar-link">Jul</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#log4j" class="sidebar-link">Log4j</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#jcl" class="sidebar-link">Jcl</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#slf4j-logback" class="sidebar-link">slf4j + logback</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Tools/日志&amp;json/JavaTools.html#日志之间切换" class="sidebar-link">日志之间切换</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="json"><a href="#json" class="header-anchor">#</a> JSON</h2> <p>常用的库：</p> <ul><li>fastjson</li> <li>jaskson</li> <li>gson</li></ul> <p>将 Java 对象转换成 json 格式也是<strong>序列化操作</strong>。</p> <blockquote><p>序列化：将 bean、amp、collection 等转为 json 字符串。</p></blockquote> <h3 id="fastjson"><a href="#fastjson" class="header-anchor">#</a> FastJson</h3> <h4 id="序列化"><a href="#序列化" class="header-anchor">#</a> 序列化</h4> <ul><li>空值序列化</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// Null也会序列化</span>
<span class="token class-name">String</span> person <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>WriteMapNullValue</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>日期格式处理</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 在实体类的时间属性上使用@JSONField注解</span>

<span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>format <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> registerDate<span class="token punctuation">;</span>
<span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>format <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> birthDay<span class="token punctuation">;</span>
</code></pre></div><ul><li>引用探测，在序列化含有多个相同 item 的集合时会用 <code>$ref</code> 表示重复项，以节省空间。
<strong>禁用引用探测</strong></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token class-name">SerializerFeature<span class="token punctuation">.</span>DisableCircularReferenceDetect</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>定制 json 格式，使用 SerializeFilter 设置。</p> <p>✅例子：key 值大写</p></li></ul> <p><img src="https://cdn.jsdelivr.net/gh/Nova-mist/HexoBlogResources/images/2022/202210100020491.png" alt="image-20221010002021055"></p> <h4 id="反序列化"><a href="#反序列化" class="header-anchor">#</a> 反序列化</h4> <ul><li>默认忽略类中不存在的属性</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">,</span> <span class="token class-name">Person</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>🟢处理泛型。在反序列化后可以自动获取到泛型类型，不需要强制转换类型。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// ResultVO</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultVO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">Boolean</span> success <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ResultVO</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResultVO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildSuccess</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResultVO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> resultVO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultVO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultVO<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultVO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ResultVO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> personResultVO <span class="token operator">=</span> <span class="token class-name">ResultVO</span><span class="token punctuation">.</span><span class="token function">buildSuccess</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 序列化</span>
<span class="token class-name">String</span> voJsonStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>personResultVO<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 传入反序列化的类型</span>
<span class="token class-name">ResultVO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span></span> deSerializedVO <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>voJsonStr<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResultVO</span><span class="token punctuation">&lt;</span><span class="token class-name">Person</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取对象 不需要强制类型转换</span>
<span class="token class-name">Person</span> data <span class="token operator">=</span> deSerializedVO<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="通用配置"><a href="#通用配置" class="header-anchor">#</a> 通用配置</h4> <ul><li><p>美化输出 <code>prettyFormat = true</code></p></li> <li></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;address&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> addr<span class="token punctuation">;</span>
</code></pre></div><ul><li>忽略指定属性（不参与序列化与反序列化）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@JSONField</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">,</span> serialize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> deserialize <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span>
</code></pre></div><h3 id="jackson"><a href="#jackson" class="header-anchor">#</a> JackSon</h3> <p>jsr319 处理 jdk 8时间日期 api</p> <p><strong>安装依赖</strong></p> <p>需要使用 <code>jackson-datatype-jsr310</code> 模块来处理 Java8 的时间日期类型，例如 LocalDate。</p> <p>使用前要注册模块。</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.13.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- jsr310 --&gt;</span>
<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.datatype/jackson-datatype-jsr310 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.datatype<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-datatype-jsr310<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.13.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="序列化-2"><a href="#序列化-2" class="header-anchor">#</a> 序列化</h4> <p>ObjectMapper 线程安全。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DATE_TIME_FORMAT</span> <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 全局配置</span>
<span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token comment">// 不显示空值</span>
    <span class="token comment">// objectMapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);</span>
    
    <span class="token comment">// 美化输出</span>
    <span class="token comment">// objectMapper.configure(SerializationFeature.INDENT_OUTPUT, true);</span>
    
    <span class="token comment">// 自动注册modules</span>
    objectMapper<span class="token punctuation">.</span><span class="token function">findAndRegisterModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">String</span> jsonStr <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p>默认显示空值，如需不显示要显式设置</p></li> <li><p>时间日期格式化</p> <ul><li><p>局部设置：通过 <code>@JsonFormat</code> 注解</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">,</span> timezone <span class="token operator">=</span> <span class="token string">&quot;GMT+8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Date</span> birth<span class="token punctuation">;</span>
<span class="token annotation punctuation">@JsonFormat</span><span class="token punctuation">(</span>pattern <span class="token operator">=</span> <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">,</span> timezone <span class="token operator">=</span> <span class="token string">&quot;GMT+8&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> registrationDate<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>全局设置</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token comment">// Date格式</span>
    <span class="token comment">// 但是SimpleDateFormat线程不安全会传递给ObjectMapper</span>
    objectMapper<span class="token punctuation">.</span><span class="token function">setDateFormat</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token constant">DATE_TIME_FORMAT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// LocalDateTime格式</span>
    <span class="token class-name">JavaTimeModule</span> javaTimeModule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaTimeModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    javaTimeModule<span class="token punctuation">.</span><span class="token function">addSerializer</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateTimeSerializer</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token constant">DATE_TIME_FORMAT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    javaTimeModule<span class="token punctuation">.</span><span class="token function">addDeserializer</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LocalDateTimeDeserializer</span><span class="token punctuation">(</span><span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token constant">DATE_TIME_FORMAT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    objectMapper<span class="token punctuation">.</span><span class="token function">registerModule</span><span class="token punctuation">(</span>javaTimeModule<span class="token punctuation">)</span>   
<span class="token punctuation">}</span>
</code></pre></div></li></ul></li></ul> <h4 id="反序列化-2"><a href="#反序列化-2" class="header-anchor">#</a> 反序列化</h4> <p>反序列化的 LocalDateTime 等 <strong>Java8 的时间日期类型</strong>也要设置 javaTimeModule。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 反序列化配置</span>
<span class="token keyword">static</span> <span class="token punctuation">{</span>
	<span class="token comment">// 忽略不存在的属性</span>
    <span class="token comment">// objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);</span>
    objectMapper<span class="token punctuation">.</span><span class="token function">disable</span><span class="token punctuation">(</span><span class="token class-name">DeserializationFeature</span><span class="token punctuation">.</span><span class="token constant">FAIL_ON_UNKNOWN_PROPERTIES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">User</span> user <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">,</span> <span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>处理泛型</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResultDTO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> success <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ResultDTO</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ResultDTO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">buildSuccess</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ResultDTO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> resultDTO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ResultDTO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultDTO<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resultDTO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ResultDTO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userResultDTO <span class="token operator">=</span> <span class="token class-name">ResultDTO</span><span class="token punctuation">.</span><span class="token function">buildSuccess</span><span class="token punctuation">(</span>bob<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 序列化</span>
<span class="token class-name">String</span> dtoSerializationResult <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>userResultDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 反序列化</span>
<span class="token class-name">ResultDTO</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> dtoDeserializationResult <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readValue</span><span class="token punctuation">(</span>dtoSerializationResult<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TypeReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResultDTO</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="通用配置-2"><a href="#通用配置-2" class="header-anchor">#</a> 通用配置</h4> <ul><li>属性命名格式：驼峰转下划线</li></ul> <p>🟠注意：如果设置了<strong>驼峰转下划线</strong>，反序列化的时候就<strong>不会识别驼峰格式</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token punctuation">{</span>
    <span class="token comment">// 驼峰转下划线</span>
    objectMapper<span class="token punctuation">.</span><span class="token function">setPropertyNamingStrategy</span><span class="token punctuation">(</span><span class="token class-name">PropertyNamingStrategies</span><span class="token punctuation">.</span><span class="token constant">SNAKE_CASE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>指定属性名（反序列化的时候也要用此名字）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@JsonProperty</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span>
</code></pre></div><ul><li>忽略指定属性（有值也不会反序列化）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@JsonIgnore</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span>
</code></pre></div><h4 id="更新对象"><a href="#更新对象" class="header-anchor">#</a> 更新对象</h4> <p>用新的对象的非空值替换旧的对象的值。</p> <ul><li>后者有值，替换前者</li> <li>后者空值，保留前者</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">User</span> updateUser <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">updateValue</span><span class="token punctuation">(</span>originalUser<span class="token punctuation">,</span> newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="logger"><a href="#logger" class="header-anchor">#</a> Logger</h2> <h3 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h3> <p>日志框架：</p> <ul><li>log4j / log4j2 (apache)</li> <li>jul (jdk自带 java.util.logging)</li> <li>logback (qos)</li></ul> <p>日志门面：</p> <ul><li>jcl (apache)</li> <li>slf4j (qos)</li></ul> <h3 id="jul"><a href="#jul" class="header-anchor">#</a> Jul</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// method1</span>
logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span>xx<span class="token punctuation">,</span> <span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// method2</span>
logger<span class="token punctuation">.</span><span class="token function">warning</span><span class="token punctuation">(</span><span class="token string">&quot;msg&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>输出信息就是红色（Tomcat 的日志底层也是调用 jul），因为使用了 <code>System.err</code></p> <p>通过 Handler 来控制 Level 输出。</p> <p><strong>默认日志级别 FINE</strong></p> <h4 id="继承关系"><a href="#继承关系" class="header-anchor">#</a> 继承关系</h4> <ul><li>所有 logger 默认的父级是 <code>java.util.logging.LogManager$RootLogger</code></li> <li>通过名字中的 <code>.</code> 来决定父子关系</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Logger</span> logger1 <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Logger</span> logger2 <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;a.b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Logger</span> logger3 <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;a.b.c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// sout</span>
logger3<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger3<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> logger2<span class="token punctuation">;</span>
logger1<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="修改输出级别"><a href="#修改输出级别" class="header-anchor">#</a> 修改输出级别</h4> <p><img src="https://docs.oracle.com/javase/8/docs/technotes/guides/logging/logging1.gif" alt="The previous context describes this graphic"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Logger</span> logger <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// method1</span>
<span class="token comment">// 获取父级logger并设置handler(appender)级别</span>
<span class="token class-name">Handler</span><span class="token punctuation">[</span><span class="token punctuation">]</span> handlers <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHandlers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Handler</span> handler <span class="token operator">:</span> handlers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    handler<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span><span class="token class-name">Level</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// method2</span>
<span class="token comment">// 设置自己的handler</span>
<span class="token class-name">ConsoleHandler</span> selfHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConsoleHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">addHandler</span><span class="token punctuation">(</span>selfHander<span class="token punctuation">)</span><span class="token punctuation">;</span>
logger<span class="token punctuation">.</span><span class="token function">setUseParentHandlers</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不继承父级Handler</span>
logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;logger3 info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>由于 Handler 默认继承，如果也设置了本 logger 自己的 Handler，就会出现<strong>日志重复输出</strong>问题，需要关闭继承父级 Handler。</p> <h4 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h4> <blockquote><p>默认配置文件 <code>$JAVA_HOME/jre/lib/logging.properties</code></p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/Nova-mist/HexoBlogResources/images/2022/202210111416247.png" alt="image-20221011141600638"></p> <ol><li><p>在 <code>resources</code> 目录新建 <code>logging.properties</code></p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token key attr-name">.level</span> <span class="token punctuation">=</span> <span class="token value attr-value">INFO # 全局level</span>
<span class="token key attr-name">com.ysama.logger.level</span> <span class="token punctuation">=</span> <span class="token value attr-value">WARNING # 指定包level</span>
</code></pre></div></li> <li><p>加载配置文件并设置</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// JulService</span>
<span class="token keyword">static</span> <span class="token class-name">LogManager</span> logManager <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getLogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token punctuation">{</span>
    logManager<span class="token punctuation">.</span><span class="token function">readConfiguration</span><span class="token punctuation">(</span><span class="token class-name">JulService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;logging.properties&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用动态包名匹配指定的level</span>
<span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">JulService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol> <h3 id="log4j"><a href="#log4j" class="header-anchor">#</a> Log4j</h3> <p>引入依赖 <code>log4j</code> 🔴注意漏洞</p> <p>开创了日志的分级别输出。</p> <p>首先会根据设定过滤 Level，再通过 appender 判断 Level 是否输出到控制台、文件等。</p> <blockquote><p>ALL &lt; FINSET &lt; FINER &lt; FINE &lt; CONFIG &lt; INFO &lt; WARNING &lt; SEVERE &lt; OFF</p></blockquote> <p>所有日志技术都有父子关系的概念，使用 <code>.</code> 来确定。</p> <p><strong>Logger 是线程同步的。</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">Log4jService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;trace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>日志级别</strong></p> <blockquote><p>trace &lt; debug &lt; info &lt; warn &lt; error &lt; fatal</p></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/Nova-mist/HexoBlogResources/images/2022/202210111459786.png" alt="image-20221011145942725"></p> <h4 id="配置文件-2"><a href="#配置文件-2" class="header-anchor">#</a> 配置文件</h4> <p>运行必须要有配置文件，默认去 classpath 下寻找。</p> <p>在 <code>resources</code> 目录下新建 <code>log4j.properties</code></p> <p>🟢可以去官方找模板</p> <div class="language-properties extra-class"><pre class="language-properties"><code><span class="token comment"># 必须要给rootLogger关联appender 否则会报错</span>
<span class="token key attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token value attr-value">INFO,xxx</span>

<span class="token comment"># 配置控制台的appender，xxx是名字</span>
<span class="token key attr-name">log4j.appender.xxx</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.apache.log4j.ConsoleAppender</span>
<span class="token key attr-name">log4j.appender.xxx.Target</span> <span class="token punctuation">=</span> <span class="token value attr-value">System.out</span>
<span class="token comment"># 单个的appender的Level过滤</span>
<span class="token key attr-name">log4j.appender.xxx.Threshold</span> <span class="token punctuation">=</span> <span class="token value attr-value">INFO</span>
<span class="token comment"># 日志格式</span>
<span class="token key attr-name">log4j.appender.xxx.layout</span> <span class="token punctuation">=</span> <span class="token value attr-value">org.apache.log4j.PatternLayout</span>

<span class="token key attr-name">＃d：date</span> <span class="token value attr-value">％-5p：日志级别％20c：全类名％L：第几行％m：自己打印的message </span>
<span class="token key attr-name">log4j.appender.xxx.layout.ConversionPattern</span> <span class="token punctuation">=</span> <span class="token value attr-value">%d{yyyy-MM-dd HH:mm:ss} %-5p %20c %L:%m %n</span>

<span class="token comment"># 注意日志重复输出问题 因为继承了rootLogge</span>
<span class="token key attr-name">com.ysama.logger</span> <span class="token punctuation">=</span> <span class="token value attr-value">ERROR,xxx</span>
</code></pre></div><blockquote><p>DailyRollingFileAppender 每天都输出一次日志</p> <p>如果只保留7天日志？</p> <ol><li><p>linux 设置 crontab</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">find</span> /home/ysama/logs/ <span class="token parameter variable">-type</span> f <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>RollingFileAppender 可以指定单个文件最大size以及保留多少个日志文件</p></li></ol></blockquote> <p><img src="https://cdn.jsdelivr.net/gh/Nova-mist/HexoBlogResources/images/2022/202210111450885.png" alt="image-20221011145041645"></p> <h3 id="jcl"><a href="#jcl" class="header-anchor">#</a> Jcl</h3> <p>引入依赖 <code>commons-logging</code></p> <p>Jcl 只是一个日志门面，底层可以设置使用不同的api。</p> <p><strong>默认使用 Jul 作为底层 api</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// JclService</span>
<span class="token keyword">private</span> <span class="token class-name">Log</span> log <span class="token operator">=</span> <span class="token class-name">LogFactory</span><span class="token punctuation">.</span><span class="token function">getLog</span><span class="token punctuation">(</span><span class="token class-name">JclService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;trace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;warn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    log<span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span><span class="token string">&quot;fatal&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="切换使用-log4j-api"><a href="#切换使用-log4j-api" class="header-anchor">#</a> 切换使用 log4j-api</h4> <ol><li>引入 log4j 依赖</li> <li>添加 log4j 配置文件</li></ol> <p>之后就会自动切换为 log4j</p> <h4 id="切换-api-原理"><a href="#切换-api-原理" class="header-anchor">#</a> 切换 api 原理</h4> <blockquote><p>jcl 对不同的日志做了适配，使用适配器的设计模式，在运行时通过类加载器的机制动态获取 loggerImpl</p></blockquote> <p>☕查看源码：</p> <ul><li><p><code>LogFactory</code> -&gt; <code>getFactory()</code>，会自动寻找配置文件 <code>commons-logging.properties</code>，返回工厂实例</p></li> <li><p><code>LogFactory</code> -&gt; <code>getInstance()</code>，从抽象类找到实例 <code>LogFactoryImpl</code>，接着找到 <code>newInstance()</code> -&gt; <code>discoverLogImplementation()</code> 方法</p></li> <li><p>在上面找到的方法中看到有一行代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 只要获取到一个Logger实例就会退出循环</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>classesToDiscover<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> result <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token function">createLogFromClass</span><span class="token punctuation">(</span>classesToDiscover<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> logCategory<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>查看变量，找到了 log4j 的一个 logger 实现</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classesToDiscover <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">LOGGING_IMPL_LOG4J_LOGGER</span><span class="token punctuation">,</span>
    <span class="token string">&quot;org.apache.commons.logging.impl.Jdk14Logger&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;org.apache.commons.logging.impl.Jdk13LumberjackLogger&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;org.apache.commons.logging.impl.SimpleLog&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">LOGGING_IMPL_LOG4J_LOGGER</span> <span class="token operator">=</span> <span class="token string">&quot;org.apache.commons.logging.impl.Log4JLogger&quot;</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p><code>createLogFromClass()</code> 方法负责创建上面各个 logger 实现类的实例。</p> <p>在方法中首先会尝试使用 <code>Class.forNmae</code> 寻找 <code>org.apache.commons.logging.impl.Log4JLogger</code>，<code>Log4JLogger</code> 中引用了 log4j 的 Logger，但因为没有导入 log4j 依赖于是报错导致 logAdatper 没有赋值，会返回空的 Logger。（如果成功会返回 Log4JLogger 适配器实例）</p></li> <li><p><code>Jdk14Logger</code> 中引入的是 <strong>jul 的 Logger</strong>，是一种适配器模式。</p></li></ul> <h3 id="slf4j-logback"><a href="#slf4j-logback" class="header-anchor">#</a> slf4j + logback</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-classic --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>logback-classic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><p>同时自带了 <code>slf4j-api</code> 和 <code>logback-core</code>，但还是再引入一次 <code>slf4j-api</code> 最好，避免找不到依赖。</p> <p>🟠 需要使用 <code>logback.xml</code> 配置文件</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 也可以用${user.home} --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>LOG_HOME<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./logs<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>appName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>STDOUT<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>appLogAppender<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>${LOG_HOME}/${appName}.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 超出容量后会重命名 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>${LOG_HOME}/${appName}-%d{yyyy-MM-dd}-%i.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxHistory</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxHistory</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>100MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maxFileSize</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>totalSizeCap</span><span class="token punctuation">&gt;</span></span>1GB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>totalSizeCap</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- additivity=false表示不继承父级appender --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>logger</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.ysama.TestSlf4j<span class="token punctuation">&quot;</span></span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FINE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">additivity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>STDOUT<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>appLogAppender<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>logger</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>debug<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>STDOUT<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>appLogAppender<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="日志之间切换"><a href="#日志之间切换" class="header-anchor">#</a> 日志之间切换</h3> <p><img src="https://cdn.jsdelivr.net/gh/Nova-mist/HexoBlogResources/images/2022/202210121330071.png" alt="image-20221012133026611"></p> <p>一般的搭配情况：</p> <ol><li>jcl 门面 + log4j / jul 底层 api</li> <li>slf4j 门面 + logback 底层 api</li> <li>slf4j 门面 + 引入适配器包 + [jcl 的体系] / log4j / jul 底层。（抽象层 + 中间层 + 实现层）
<strong>原理：将 log4j 等的 Logger 包装成 slf4j 的 Logger，最终输出用的是 log4j。</strong></li> <li>本项目使用的是 slf4j + logback，引入的依赖使用了 log4j，需要将引入依赖的日志输出<strong>桥接</strong>到  slf4j 门面进行输出，不需要再单独设置 log4j 的配置文件。</li></ol> <p><img src="https://cdn.jsdelivr.net/gh/Nova-mist/HexoBlogResources/images/2022/202210121414008.png" alt="image-20221012141414803"></p> <h4 id="slf4j-log4j"><a href="#slf4j-log4j" class="header-anchor">#</a> slf4j + log4j</h4> <ol><li>引入依赖 <code>slf4j</code> + <code>slf4j-log4j</code></li></ol> <p>注意依赖的 <code>&lt;scope&gt;</code> 不能是 test，去掉即可。否则会报错 <code>No SLF4J providers were found.</code></p> <p><strong>注意版本问题</strong></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-log4j12 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ol start="2"><li>在 <code>resources</code> 目录下新建 <code>log4j.properties</code> 配置文件。</li></ol> <h4 id="log4j-桥接到-slf4j"><a href="#log4j-桥接到-slf4j" class="header-anchor">#</a> log4j 桥接到 slf4j</h4> <ol><li><p>准备测试环境：</p> <ul><li>log4j 依赖模块</li> <li>slf4j + logback 主模块</li></ul></li> <li><p>主模块依赖</p> <p>引入了子模块的 service 但是<strong>排除了子模块的 log4j 依赖</strong>（桥接器的优先级要高于log4j）</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>module-6-logger-log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- slf4j + logback --&gt;</span>
<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/ch.qos.logback/logback-classic --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>logback-classic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/slf4j-api --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 桥接依赖的log4j --&gt;</span>
<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.slf4j/log4j-over-slf4j --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j-over-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ol> <p>桥接器的内部包名和类名和 log4j 相同（api 相同），但是具体的实现则是调用了 slf4j 的 api。<strong>子依赖调用的 log4j 接口的内部实现是 slf4j 接口。</strong></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/8/2022, 2:56:58 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/NovaBlog/Tools/%E6%97%A5%E5%BF%97&amp;json/" class="prev router-link-active">
        列表
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/NovaBlog/assets/js/app.7283b6f5.js" defer></script><script src="/NovaBlog/assets/js/2.6539ea43.js" defer></script><script src="/NovaBlog/assets/js/36.44753080.js" defer></script>
  </body>
</html>
