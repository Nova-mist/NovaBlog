<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>并发 | Nova Blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="我那摊大饼一样的零散学习笔记">
    
    <link rel="preload" href="/NovaBlog/assets/css/0.styles.26d8bde2.css" as="style"><link rel="preload" href="/NovaBlog/assets/js/app.7283b6f5.js" as="script"><link rel="preload" href="/NovaBlog/assets/js/2.6539ea43.js" as="script"><link rel="preload" href="/NovaBlog/assets/js/27.80bd39a6.js" as="script"><link rel="prefetch" href="/NovaBlog/assets/js/10.681f19e7.js"><link rel="prefetch" href="/NovaBlog/assets/js/11.adb3fca2.js"><link rel="prefetch" href="/NovaBlog/assets/js/12.e509a0f8.js"><link rel="prefetch" href="/NovaBlog/assets/js/13.0ace9699.js"><link rel="prefetch" href="/NovaBlog/assets/js/14.f11331b6.js"><link rel="prefetch" href="/NovaBlog/assets/js/15.c3fe2b37.js"><link rel="prefetch" href="/NovaBlog/assets/js/16.76473f3a.js"><link rel="prefetch" href="/NovaBlog/assets/js/17.1e6e96a7.js"><link rel="prefetch" href="/NovaBlog/assets/js/18.de0f476b.js"><link rel="prefetch" href="/NovaBlog/assets/js/19.464c0b71.js"><link rel="prefetch" href="/NovaBlog/assets/js/20.adc0ad6e.js"><link rel="prefetch" href="/NovaBlog/assets/js/21.a75102d0.js"><link rel="prefetch" href="/NovaBlog/assets/js/22.409ca266.js"><link rel="prefetch" href="/NovaBlog/assets/js/23.4b83f159.js"><link rel="prefetch" href="/NovaBlog/assets/js/24.b80958e2.js"><link rel="prefetch" href="/NovaBlog/assets/js/25.bbdd2bef.js"><link rel="prefetch" href="/NovaBlog/assets/js/26.0ed31014.js"><link rel="prefetch" href="/NovaBlog/assets/js/28.2772d3d5.js"><link rel="prefetch" href="/NovaBlog/assets/js/29.d14c59ce.js"><link rel="prefetch" href="/NovaBlog/assets/js/3.672c28f4.js"><link rel="prefetch" href="/NovaBlog/assets/js/30.3edde461.js"><link rel="prefetch" href="/NovaBlog/assets/js/31.da8777c1.js"><link rel="prefetch" href="/NovaBlog/assets/js/32.fa19d459.js"><link rel="prefetch" href="/NovaBlog/assets/js/33.2d3adc2b.js"><link rel="prefetch" href="/NovaBlog/assets/js/34.35850d01.js"><link rel="prefetch" href="/NovaBlog/assets/js/35.b14e62bb.js"><link rel="prefetch" href="/NovaBlog/assets/js/36.44753080.js"><link rel="prefetch" href="/NovaBlog/assets/js/37.8d2088d4.js"><link rel="prefetch" href="/NovaBlog/assets/js/38.4366f780.js"><link rel="prefetch" href="/NovaBlog/assets/js/39.c9f5137d.js"><link rel="prefetch" href="/NovaBlog/assets/js/4.854c56f8.js"><link rel="prefetch" href="/NovaBlog/assets/js/40.68c696f4.js"><link rel="prefetch" href="/NovaBlog/assets/js/41.7190c7b3.js"><link rel="prefetch" href="/NovaBlog/assets/js/42.7710aff4.js"><link rel="prefetch" href="/NovaBlog/assets/js/43.9f513289.js"><link rel="prefetch" href="/NovaBlog/assets/js/44.493f11ea.js"><link rel="prefetch" href="/NovaBlog/assets/js/45.66cd96d8.js"><link rel="prefetch" href="/NovaBlog/assets/js/46.f5e4e401.js"><link rel="prefetch" href="/NovaBlog/assets/js/47.c2f3caf8.js"><link rel="prefetch" href="/NovaBlog/assets/js/48.74afa3cf.js"><link rel="prefetch" href="/NovaBlog/assets/js/49.ea737da6.js"><link rel="prefetch" href="/NovaBlog/assets/js/5.f7ccee55.js"><link rel="prefetch" href="/NovaBlog/assets/js/50.3eca0141.js"><link rel="prefetch" href="/NovaBlog/assets/js/51.949ffca7.js"><link rel="prefetch" href="/NovaBlog/assets/js/52.d007ce86.js"><link rel="prefetch" href="/NovaBlog/assets/js/53.252a0d24.js"><link rel="prefetch" href="/NovaBlog/assets/js/54.97c86c53.js"><link rel="prefetch" href="/NovaBlog/assets/js/55.4577ea3a.js"><link rel="prefetch" href="/NovaBlog/assets/js/56.085a6c0d.js"><link rel="prefetch" href="/NovaBlog/assets/js/57.6804712d.js"><link rel="prefetch" href="/NovaBlog/assets/js/58.559b3cac.js"><link rel="prefetch" href="/NovaBlog/assets/js/59.48650730.js"><link rel="prefetch" href="/NovaBlog/assets/js/6.14027d31.js"><link rel="prefetch" href="/NovaBlog/assets/js/60.e53abbd4.js"><link rel="prefetch" href="/NovaBlog/assets/js/61.53d32451.js"><link rel="prefetch" href="/NovaBlog/assets/js/62.f93973c5.js"><link rel="prefetch" href="/NovaBlog/assets/js/63.9dd5b9b3.js"><link rel="prefetch" href="/NovaBlog/assets/js/64.4a1ac6da.js"><link rel="prefetch" href="/NovaBlog/assets/js/65.84f958d2.js"><link rel="prefetch" href="/NovaBlog/assets/js/66.38972cd8.js"><link rel="prefetch" href="/NovaBlog/assets/js/67.97df1d7d.js"><link rel="prefetch" href="/NovaBlog/assets/js/68.f78ccdc1.js"><link rel="prefetch" href="/NovaBlog/assets/js/69.9d476a9c.js"><link rel="prefetch" href="/NovaBlog/assets/js/7.5c5bd089.js"><link rel="prefetch" href="/NovaBlog/assets/js/70.28382d01.js"><link rel="prefetch" href="/NovaBlog/assets/js/71.4a4fdf3a.js"><link rel="prefetch" href="/NovaBlog/assets/js/72.646ad1ce.js"><link rel="prefetch" href="/NovaBlog/assets/js/73.2f2ebeb1.js"><link rel="prefetch" href="/NovaBlog/assets/js/74.22b83718.js"><link rel="prefetch" href="/NovaBlog/assets/js/75.50e2585a.js"><link rel="prefetch" href="/NovaBlog/assets/js/76.998e5fbe.js"><link rel="prefetch" href="/NovaBlog/assets/js/77.e805e4a0.js"><link rel="prefetch" href="/NovaBlog/assets/js/8.f20fe421.js"><link rel="prefetch" href="/NovaBlog/assets/js/9.749c610b.js">
    <link rel="stylesheet" href="/NovaBlog/assets/css/0.styles.26d8bde2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/NovaBlog/" class="home-link router-link-active"><!----> <span class="site-name">Nova Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/NovaBlog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/Mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/Spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/SpringBoot/" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/SpringMVC/" class="nav-link">
  Spring MVC
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/基础/" class="nav-link">
  基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tools" class="mobile-dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/接口/" class="nav-link">
  接口
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/日志&amp;json/" class="nav-link">
  日志&amp;json
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/部署/" class="nav-link">
  部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/web/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/状态管理/" class="nav-link">
  状态管理
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/组件库/" class="nav-link">
  组件库
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/路由/" class="nav-link">
  路由
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/中间件/ELK/" class="nav-link">
  ELK
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/数据库/MySQL/" class="nav-link">
  My SQL
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/数据库/Redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/其他/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/动规/" class="nav-link">
  动规
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/贪心/" class="nav-link">
  贪心
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/链表二叉树/" class="nav-link">
  链表二叉树
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/NovaBlog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/Mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/Spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/SpringBoot/" class="nav-link">
  Spring Boot
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/SpringMVC/" class="nav-link">
  Spring MVC
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Java/基础/" class="nav-link">
  基础
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tools" class="dropdown-title"><span class="title">Tools</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tools" class="mobile-dropdown-title"><span class="title">Tools</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/Git/" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/接口/" class="nav-link">
  接口
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/日志&amp;json/" class="nav-link">
  日志&amp;json
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/Tools/部署/" class="nav-link">
  部署
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web" class="dropdown-title"><span class="title">web</span> <span class="arrow down"></span></button> <button type="button" aria-label="web" class="mobile-dropdown-title"><span class="title">web</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/web/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/基础/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/状态管理/" class="nav-link">
  状态管理
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/组件库/" class="nav-link">
  组件库
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/web/路由/" class="nav-link">
  路由
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/中间件/ELK/" class="nav-link">
  ELK
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/数据库/MySQL/" class="nav-link">
  My SQL
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/数据库/Redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/其他/" class="nav-link">
  其他
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/动规/" class="nav-link">
  动规
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/贪心/" class="nav-link">
  贪心
</a></li><li class="dropdown-item"><!----> <a href="/NovaBlog/算法/链表二叉树/" class="nav-link">
  链表二叉树
</a></li></ul></div></div><div class="nav-item"><a href="https://google.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NovaBlog/Java/%E5%9F%BA%E7%A1%80/" aria-current="page" class="sidebar-link">基础</a></li><li><a href="/NovaBlog/Java/基础/Java语法基础.html" class="sidebar-link">Java基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Java语法基础.html#关键词-throw-throws" class="sidebar-link">关键词 throw &amp; throws</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Java语法基础.html#使用随机数" class="sidebar-link">使用随机数</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Java语法基础.html#【概念】pojo-vs-javabeans" class="sidebar-link">【概念】POJO vs JavaBeans</a></li></ul></li><li><a href="/NovaBlog/Java/基础/Maven-note.html" class="sidebar-link">Maven 相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#命令" class="sidebar-link">命令</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#依赖范围-scopes" class="sidebar-link">依赖范围 Scopes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#概念" class="sidebar-link">概念</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#访问性" class="sidebar-link">访问性</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#依赖传递" class="sidebar-link">依赖传递</a></li></ul></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#可选依赖和依赖排除" class="sidebar-link">可选依赖和依赖排除</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#spring-boot-starter-parent" class="sidebar-link">spring-boot-starter-parent</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#dependencymanagement" class="sidebar-link">dependencyManagement</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#插件" class="sidebar-link">插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#maven-compiler-plugin" class="sidebar-link">maven-compiler-plugin</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/Maven-note.html#spring-boot-maven-plugin" class="sidebar-link">spring-boot-maven-plugin</a></li></ul></li></ul></li><li><a href="/NovaBlog/Java/基础/Restful风格.html" class="sidebar-link">REST 风格</a></li><li><a href="/NovaBlog/Java/基础/java并发复习.html" class="active sidebar-link">并发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#概念" class="sidebar-link">概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#进程与线程" class="sidebar-link">进程与线程</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#并发与并行" class="sidebar-link">并发与并行</a></li></ul></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#thread" class="sidebar-link">Thread</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#四种实现方法" class="sidebar-link">四种实现方法</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#中断" class="sidebar-link">中断</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#守护线程" class="sidebar-link">守护线程</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#线程组" class="sidebar-link">线程组</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#threadlocal" class="sidebar-link">ThreadLocal</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#异常处理" class="sidebar-link">异常处理</a></li></ul></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#线程安全的集合类" class="sidebar-link">线程安全的集合类</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#thread安全" class="sidebar-link">Thread安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#隐式锁" class="sidebar-link">隐式锁</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#显示锁lock" class="sidebar-link">显示锁Lock</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#显示锁readwritelock" class="sidebar-link">显示锁ReadWriteLock</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#显示锁stampedlock" class="sidebar-link">显示锁StampedLock</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#单例模式写法" class="sidebar-link">单例模式写法</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#volatile" class="sidebar-link">volatile</a></li></ul></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#tips" class="sidebar-link">tips</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#多线程i" class="sidebar-link">多线程i++</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#死锁" class="sidebar-link">死锁</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/java并发复习.html#活锁" class="sidebar-link">活锁</a></li></ul></li></ul></li><li><a href="/NovaBlog/Java/基础/序列化.html" class="sidebar-link">序列化</a></li><li><a href="/NovaBlog/Java/基础/设计模式-note.html" class="sidebar-link">设计模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/设计模式-note.html#观察者模式" class="sidebar-link">观察者模式</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/设计模式-note.html#代理模式" class="sidebar-link">代理模式</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/设计模式-note.html#适配器模式" class="sidebar-link">适配器模式</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/设计模式-note.html#装饰器模式" class="sidebar-link">装饰器模式</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/设计模式-note.html#单例模式" class="sidebar-link">单例模式</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/设计模式-note.html#工厂模式" class="sidebar-link">工厂模式</a></li><li class="sidebar-sub-header"><a href="/NovaBlog/Java/基础/设计模式-note.html#抽象工厂模式" class="sidebar-link">抽象工厂模式</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="并发"><a href="#并发" class="header-anchor">#</a> 并发</h1> <h2 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h2> <h3 id="进程与线程"><a href="#进程与线程" class="header-anchor">#</a> 进程与线程</h3> <ul><li>进程是程序运行<strong>资源分配</strong>的最小单位，分为系统进程和用户进程。</li> <li>线程是<strong>CPU调度</strong>的最小单位，必须依赖与进程存在。（操作系统调度的最小单位）</li></ul> <p><strong>进程是多个线程的容器。</strong></p> <p><strong>安全性：</strong></p> <ul><li>进程之间相互独立</li> <li>同一个进程里面的多线程资源共享</li></ul> <hr> <h3 id="并发与并行"><a href="#并发与并行" class="header-anchor">#</a> 并发与并行</h3> <ul><li>并行：进程产生的总线程数小于CPU的核心数，则不同进程的线程可以分配给不同的CPU来运行。<strong>各个进程是真正地同时运行。</strong></li> <li>并发：进程分配的线程数大于CPU的核心线程数。<strong>一个核心同时运行多个进程，涉及调度。</strong></li></ul> <h2 id="thread"><a href="#thread" class="header-anchor">#</a> Thread</h2> <h3 id="四种实现方法"><a href="#四种实现方法" class="header-anchor">#</a> 四种实现方法</h3> <ol><li><p>继承Thread</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> myThread <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// do sth.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadTest</span> <span class="token punctuation">{</span>
    psvm <span class="token punctuation">{</span>
        myThread thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">myThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token comment">// 匿名类写法</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do sth.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>实现Runnable接口</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> myThread <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// do sth.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadTest</span> <span class="token punctuation">{</span>
    psvm <span class="token punctuation">{</span>
        myThread thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">myThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>实现Callable接口，实现 <code>call()</code> 方法可以返回结果。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> myThread <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// do sth.</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Hello&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadTest</span> <span class="token punctuation">{</span>
    psvm <span class="token punctuation">{</span>
        myThread thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">myThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> futuretask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FutureTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>thread<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>futuretask<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 只有主线程调用get方法才会继续往下面执行</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Return result: &quot;</span> <span class="token operator">+</span> futuretask<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>使用 Java8 引入的 lambda 语法。</p></li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span><span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; running...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        t<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Main exit...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="中断"><a href="#中断" class="header-anchor">#</a> 中断</h3> <ol><li>Thread.stop() 强迫停止一个线程，不安全。</li> <li>Thread.interrupt() 中断</li></ol> <blockquote><p>Java 中断机制是一种协作机制，也就是说通过中断并不能直接终止另一个程序，而需要被中断的线程自己处理中断。<strong>不一定能成功。</strong></p></blockquote> <ul><li>public static boolean interrupted() 测试当前线程是否已经中断，<strong>线程的中断状态由该方法清除</strong>。连续两次调用总返回 false。</li> <li>public bollean isInterrupted() 测试当前线程是否已经中断，不改变中断状态。</li> <li>public void interrupt() 中断线程，<strong>唯一可以将中断状态设置为true的方法</strong>。</li></ul> <hr> <h3 id="守护线程"><a href="#守护线程" class="header-anchor">#</a> 守护线程</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setDaemon</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> on<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在启动线程前调用</span>
</code></pre></div><p><strong>相当于后台运行程序，进程结束，守护线程自然而然地就会结束，不管其处于什么状态。</strong></p> <p>Java的垃圾回收就是一个守护线程，另外可以用于背景音乐的播放，文字编辑器中的自动语法检查、自动保存</p> <hr> <h3 id="线程组"><a href="#线程组" class="header-anchor">#</a> 线程组</h3> <p><strong>线程组和线程池的区别：</strong></p> <blockquote><p>线程组是为了方便线程的管理，线程池是为了管理线程的生命周期，复用线程，减少创建销毁线程的开销。</p></blockquote> <hr> <h3 id="threadlocal"><a href="#threadlocal" class="header-anchor">#</a> ThreadLocal</h3> <p><code>Thread</code>对象代表一个线程，我们可以在代码中调用<code>Thread.currentThread()</code>获取当前线程。</p> <p>打印当前线程名字 <code>Thread.currentThread().getName()</code></p> <p>使用 ThreadLocal 在一个线程中传递同一个对象。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 实例初始化</span>
<span class="token keyword">static</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> threadLocalUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">processUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        threadLocalUser<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">step2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        threadLocalUser<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">step1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> u <span class="token operator">=</span> threadLocalUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> u <span class="token operator">=</span> threadLocalUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">println</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">step2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">User</span> u <span class="token operator">=</span> threadLocalUser<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">checkUser</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>❓可以通过 <code>AutoCloseable</code> 接口配合 <code>try (resource) {...}</code>结构，让编译器自动为我们关闭。</p> <hr> <h3 id="异常处理"><a href="#异常处理" class="header-anchor">#</a> 异常处理</h3> <ol><li>checked exception --&gt; try-catch</li> <li>unchecked exception --&gt; setUncaughtExceptionHandler()
异常发生时传入UncaughtExceptionHandler参数的uncaughtException方法会被调用</li></ol> <p><strong>handle unchecked exception</strong>:</p> <ul><li>定义一个类实现UncaughtExceptionHandler接口，在实现的 uncaughtException(Thread t, Throwable e) 方法里包含对异常处理的逻辑和步骤。</li> <li>定义线程执行和逻辑。</li> <li>在 thread.start() 前加入 thread.setUncaughtExceptionHandler()</li></ul> <h2 id="线程安全的集合类"><a href="#线程安全的集合类" class="header-anchor">#</a> 线程安全的集合类</h2> <ul><li>Hashtable</li> <li>ConcurrentHashMap 使用了代码块锁而不是方法锁</li> <li>CopyOnWrite 在复制的副本中添加元素后再将原容器的引用指向新的容器
适合<strong>读多写少</strong>的并发场景：白名单黑名单、商品类目地访问和更新。
<strong>数据一致性问题</strong></li> <li>StringBuffer &amp; StringBuilder
直接使用 <code>+</code> 拼接字符串会建立很多String型对象，会对服务器资源和性能造成影响。
<ul><li>StringBuffer线程安全。</li> <li>StringBuilder线程不安全，没有加<strong>synchronized</strong>锁，但效率和性能高。</li></ul></li></ul> <h2 id="thread安全"><a href="#thread安全" class="header-anchor">#</a> Thread安全</h2> <p>CPU读取数据顺序：寄存器 -&gt; 高速缓存 -&gt; 内存</p> <p>JMM (Java Memory Model) 规定了 JVM 有主内存和工作内存。</p> <ul><li>主内存就是Java堆内存，存放程序中所有的类实例、静态数据等变量，由多个线程共享。</li> <li>工作内存存放的是该线程从主内存中拷贝过来的变量以及访问方法所获取的局部变量，每个线程私有。</li> <li><strong>每个线程对变量的操作都是先从主内存将其拷贝到工作内存再进行操作。</strong></li> <li>多个线程需要通过主内存间接通信</li></ul> <p>线程操作某个对象时：</p> <ol><li>从主存复制变量到当前工作内存 (read and load)</li> <li>执行代码，改变共享变量值 (use and assign)</li> <li>用工作内存数据刷新主存相关内容 (store and write)</li></ol> <p><strong>产生时序性问题</strong></p> <p>==要保证锁定一定会被释放，就必须将 unlock() 放到 finally{} 中==</p> <hr> <h3 id="隐式锁"><a href="#隐式锁" class="header-anchor">#</a> 隐式锁</h3> <p>使用<code>synchronized</code>解决了多线程同步访问共享变量的正确性问题。但是，它的缺点是带来了性能下降。因为<code>synchronized</code>代码块无法并发执行。此外，加锁和解锁需要消耗一定的时间，所以，<code>synchronized</code>会降低程序的执行效率。</p> <p>🟠资源消耗：同步方法体 &gt; 方法内代码块 &gt; 对象锁</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 对象锁</span>
<span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// do sth.</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 同步方法体</span>
<span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count <span class="token operator">+=</span> n<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token comment">// 方法内代码块</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        count <span class="token operator">+=</span> n<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>🟠对一个静态方法添加<code>synchronized</code>修饰符，锁住的是该类的<code>Class</code>实例。</p> <p>任何一个类都有一个由JVM自动创建的<code>Class</code>实例。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
<span class="token punctuation">}</span>
<span class="token comment">// 等同于</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">Counter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// ...</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="显示锁lock"><a href="#显示锁lock" class="header-anchor">#</a> 显示锁Lock</h3> <p><strong>ReentrantLock应该作为全局变量</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// do sth.</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="显示锁readwritelock"><a href="#显示锁readwritelock" class="header-anchor">#</a> 显示锁ReadWriteLock</h3> <p>ReadWriteLock接口提供了 readLock 和 writeLock 两种锁的机制。</p> <p><strong>一个资源能够被多个读线程访问或者被一个写线程访问。</strong></p> <ul><li>默认非公平锁</li> <li>重入性：写线程获取写锁后可以再次获取读取锁</li> <li>降级锁：get WriteLock -&gt; get ReadLock -&gt; Release WriteLock</li> <li>支持获取锁期间被中断</li> <li>条件变量：Condition写入锁支持，读取锁不支持。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 数据缓存</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ReentrantReadWriteLock</span> rwlock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantReadWriteLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">readWrite</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 开启读锁，从缓存中去取</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 如果缓存没有数据，释放读锁，上写锁</span>
            rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rwlock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    value <span class="token operator">=</span> <span class="token string">&quot;aaa&quot;</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                rwlock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放写锁</span>
            <span class="token punctuation">}</span>
            rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 上读锁</span>
        <span class="token punctuation">}</span> <span class="token comment">// close if</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        rwlock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 释放读锁</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="显示锁stampedlock"><a href="#显示锁stampedlock" class="header-anchor">#</a> 显示锁StampedLock</h3> <p>读取悲观锁：在读取之前一定要判断一下数据有没有正在被更改。</p> <p>读取乐观锁：在读取之前不需要判断数据的一致性，只在提交操作时检查是否违反数据完整性。</p> <hr> <h3 id="单例模式写法"><a href="#单例模式写法" class="header-anchor">#</a> 单例模式写法</h3> <p><strong>线程安全高性能的写法：</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// method 1</span>
<span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token comment">// close if</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// method 2</span>
<span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token class-name">Singleton</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ReentrantLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReentrantLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Singleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            lock<span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token comment">// close if</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// method 3</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InstanceFactory</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">InstanceHolder</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Instance</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">InstanceHolder</span><span class="token punctuation">.</span>instance<span class="token punctuation">;</span> <span class="token comment">// InstanceHolder类被初始化</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <h3 id="volatile"><a href="#volatile" class="header-anchor">#</a> volatile</h3> <p><a href="https://www.geeksforgeeks.org/volatile-keyword-in-java/" target="_blank" rel="noopener noreferrer">volatile Keyword in Java - GeeksforGeeks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>“volatile” tells the compiler that the value of a variable must never be cached as its value may change outside of the scope of the program itself.</p></blockquote> <p>🟠锁和同步的两大特性：</p> <ul><li>互斥性（原子性） Mutual Exclusion，只能有一个线程执行代码块。</li> <li>可见性 Visibility，一个线程对共享数据的修改对其他线程可见。</li></ul> <p><strong>Synchronized</strong> 保证了互斥性和可见性。</p> <p><strong>Volatile</strong> 只保证了可见性，让变量不会被缓存，读写直接与主内存交互。</p> <h2 id="tips"><a href="#tips" class="header-anchor">#</a> tips</h2> <p>对于执行时间长的子线程，要在线程 start 之后使用 <code>thread.join()</code> ，阻塞主线程直到子线程结束。</p> <h3 id="多线程i"><a href="#多线程i" class="header-anchor">#</a> 多线程i++</h3> <p><a href="https://www.geeksforgeeks.org/thread-safety-and-how-to-achieve-it-in-java/" target="_blank" rel="noopener noreferrer">Thread Safety and how to achieve it in Java - GeeksforGeeks<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>2021版Java多线程教程41：什么是原子性？i++是原子操作吗？ - 知乎 <a href="https://www.zhihu.com/zvideo/1381705619834052608" target="_blank" rel="noopener noreferrer">https://www.zhihu.com/zvideo/1381705619834052608<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/yudianxiaoxiao/article/details/107592452" target="_blank" rel="noopener noreferrer">volatile 关键字能保证数据的可见性,但不能保证数据的原子性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><strong>通过 <code>Thread.sleep</code> 休眠来让原子性问题显而易见</strong></li> <li>volatile 不能确保原子性。虽然直接与主内存交互，但也是同时修改。</li> <li>synchronized 同步可以解决原子性问题。</li> <li>使用原子类 AtomicInteger 可以解决原子性问题。</li></ul> <hr> <h3 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h3> <p><a href="https://www.baeldung.com/java-deadlock-livelock" target="_blank" rel="noopener noreferrer">Java Thread Deadlock and Livelock | Baeldung<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>避免死锁：</strong></p> <ol><li>避免一个线程获取多个锁，如果有多个要确保获取的顺序是相同的（没有依赖循环）</li> <li>每个锁只占用一个资源</li> <li>使用定时锁 <code>lock.tryLock(timeout)</code> 代替内部锁</li></ol> <hr> <h3 id="活锁"><a href="#活锁" class="header-anchor">#</a> 活锁</h3> <p>多个线程持续切换状态，总是因为不满足条件而无法执行任务。</p> <p>例子：有两个线程和两把锁，每个线程都需要<strong>固定顺序的两把锁</strong>才能执行任务，当只得到一把的时候会释放锁并重新尝试获取。</p> <p><strong>避免活锁：</strong></p> <ul><li>按随机的顺序来获取锁，让竞争公平。</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">11/8/2022, 2:56:58 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/NovaBlog/Java/基础/Restful风格.html" class="prev">
        REST 风格
      </a></span> <span class="next"><a href="/NovaBlog/Java/基础/序列化.html">
        序列化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/NovaBlog/assets/js/app.7283b6f5.js" defer></script><script src="/NovaBlog/assets/js/2.6539ea43.js" defer></script><script src="/NovaBlog/assets/js/27.80bd39a6.js" defer></script>
  </body>
</html>
